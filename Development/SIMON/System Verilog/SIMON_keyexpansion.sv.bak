module SIMON_keyexpansion
#(	parameter N = 16,
	parameter M = 4			)
 (	input int count,
	input logic [N-1:0][M-1:0] keys,
	output logic [N-1:0] out	);

logic [N-1:0] tmp;
reg [61:0] z = 62'b01100111000011010100100010111110110011100001101010010001011111;

always_comb
begin
	tmp = {keys[M-1][2:0], keys[M-1][N-1:3]};
if(M==4)
begin
	tmp ^= keys[M-3];
end
	tmp ^= {tmp[0], tmp[N-1:1]};
	out = ~keys[0] ^ tmp ^ z[count%62] ^ 3;
end

endmodule